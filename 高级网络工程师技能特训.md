# 大纲

1.局域网技术
  vlan,trunk，stp,eth-trunk
  vrrp,bfd,dhcp
2.路由部分
  OSPF,ISIS,BGP
3.VPN技术
  MPLS,IPSEC
4.组播
5.IPV6
6.QOS
7.BFD,NQA,NAT



# LAN部分

1.交换机互联部署Trunk，放行必要的VLAN
  如图所示每台交换机添加必要VLAN
  S1与S3,S2与S3互联放行VLAN10,20,254
  S1与S2互联放行VLAN10,20,254,78

2.SW1,SW2互联配置链路聚合LACP负载分担模式
   负载分担方式采用基于源目的MAC方式
   其中主动段为SW1,活动接口上限：2
   备份接口：G0/0/21
   活动接口支持抢占，抢占延迟10s



## LSW1

```BASH
sys
sysname LSW1

vlan batch 10 20 254 78 7 127

#创建Eth-Trunk1并配置为LACP模式，提高两设备之间的带宽与可靠性
interface eth-trunk 1
mode lacp-static
#开启抢占功能
lacp preempt enable
#设置抢占延迟，默认30秒，最小10秒
lacp preempt delay 10
#确认活动的端口数的上限阈值
max active-linknumber 2
#配置成员接口加入Eth-Trunk
trunkport G 0/0/20
trunkport G 0/0/21
trunkport G 0/0/22
#负载分担
load-balance src-dst-mac

port link-type trunk
port trunk allow-pass vlan 10 20 254 78
quit

#配置系统优先级为100，使其成为LACP主动端，默认32768
lacp priority 100

int g0/0/22
lacp priority 16384

port-group group-member g0/0/23 eth1
port link-type trunk
port trunk allow-pass vlan 10 20 254
q
```

## LSW2

```BASH
sys
sysname LSW2

vlan batch 10 20 254 78 8 138

#创建Eth-Trunk1并配置为LACP模式，提高两设备之间的带宽与可靠性
interface eth-trunk 1
mode lacp-static
#配置成员接口加入Eth-Trunk
trunkport G 0/0/20
trunkport G 0/0/21
trunkport G 0/0/22

port link-type trunk
port trunk allow-pass vlan 10 20 254 78

interface G0/0/24
port link-type trunk
port trunk allow-pass vlan 10 20 254
q
```

## LSW3

```BASH
sys
sysname LSW3

vlan batch 10 20 254

port-group group-member g0/0/23 g0/0/24 
port link-type trunk
port trunk allow-pass vlan 10 20 254
q
```

查看结果

dis eth-trunk 1

dis port vlan active | include trunk

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225111344568.png" alt="image-20211225111344568" style="zoom:80%;" />

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225111533573.png" alt="image-20211225111533573" style="zoom:80%;" />

LSW2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225111637603.png" alt="image-20211225111637603" style="zoom:80%;" />

LSW3

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225113037357.png" alt="image-20211225113037357" style="zoom:80%;" />



3.设置MST配置，VLAN10加入实例1，VLAN20加入实例2
  域名：MST 修订ID:1
  S1作为实例1的根网桥，S2作为实例2的根网桥

4.SW1,SW2,SW3互联链路防止单向链路故障（利用BPDU检测）环路保护

5.除交换机互联端口外，其他非交换机接口自动设置为边缘端口

6.对于SW3上的禁止用户私自接入交换机，一旦接入自动关闭接口并且产生告警(加速收敛)

## LSW1

```BASH
stp mode mstp
#设置STP配置文件
stp region-configuration
#域名：MST
region-name MST
#修订ID:1
revision-level 1
#VLAN10加入实例1，VLAN20加入实例2
instance 1 vlan 10
instance 2 vlan 20
#使能STP配置文件
active region-configuration
q

#调整生成树结构实现负载分担
S1作为实例1的根网桥，实例2的备份根网桥
stp instance 1 root primary
stp instance 2 root secondary

#环路保护
port-group group-member g0/0/23 eth1
stp loop-protection
#交换机互联端口关闭边缘端口
stp edged-port disable
q

#交换机选举使能边缘端口
stp edged-port default
```

## LSW2

```BASH
stp mode mstp
stp region-configuration
region-name MST
revision-level 1
instance 1 vlan 10
instance 2 vlan 20
active region-configuration
q

#S2作为实例2的根网桥，实例1的备份根网桥
stp instance 2 root primary
stp instance 1 root secondary

port-group group-member g0/0/24 eth1
stp loop-protection
stp edged-port disable
q
stp edged-port default
```

## LSW3

```BASH
stp mode mstp
stp region-configuration
region-name MST
revision-level 1
instance 1 vlan 10
instance 2 vlan 20
active region-configuration
q

port-group group-member g0/0/23 g0/0/24
stp loop-protection
stp edged-port disable
q
stp edged-port default

#交换机3启用BPDU
stp bpdu-protection
```

查看结果

dis stp brief

LSW1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225115932778.png" alt="image-20211225115932778" style="zoom:80%;" />

LSW2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225115839330.png" alt="image-20211225115839330" style="zoom:80%;" />

LSW3

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225115747492.png" alt="image-20211225115747492" style="zoom:80%;" />



7.VLAN10,VLAN20分别加入VRRP组1与组2，

其中S1负责VLAN10业务转发， S2负责VLAN20的业务转发，为了防止其他网关修改VRRP结构，启用MD5认证

  SW1,SW2分别启用BFD检测CE1,CE2的Loopback0
  若BFD检测失败，自动切换主备角色（**见后**）

## LSW1

```BASH
int Vlanif 10
ip add 10.1.10.7 24
vrrp vrid 1 virtual-ip 10.1.10.254
vrrp vrid 1 priority 101
#启用MD5认证
vrrp vrid 1 authentication-mode md5 Jack20

int Vlanif 20
ip add 10.1.20.7 24
vrrp vrid 2 virtual-ip 10.1.20.254
q

```

## LSW2

```BASH
int Vlanif 10
ip add 10.1.10.8 24
vrrp vrid 1 virtual-ip 10.1.10.254
vrrp vrid 1 authentication-mode md5 Jack20

int Vlanif 20
ip add 10.1.20.8 24
vrrp vrid 2 virtual-ip 10.1.20.254
vrrp vrid 2 priority 101
q
```

查看结果

dis vrrp brief

LSW1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225121202703.png" alt="image-20211225121202703" style="zoom:80%;" />

LSW2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225121231951.png" alt="image-20211225121231951" style="zoom:80%;" />

S1负责VLAN10业务转发， S2负责VLAN20的业务转发



# 无线部分

8.2 AC1,AC2部署双机双链路备份
    其中AC1作为主AC，AC2作为备AC
    无线管理VLAN:VLAN254
    无线业务
    SSID:HUAWEI
    安全策略：WPA-WPA2 密码：Huawei@123 机密算法：AES
    业务VLAN:VLAN10
    转发方式：直接转发

使用S1为vlan10 vlan254分配地址

## LSW1

```BASH
dhcp enable

int Vlanif 7
ip add 10.1.7.7 24

int Vlanif 78
ip add 10.1.78.7 24

int Vlanif 127
ip add 10.1.127.7 24
q

#管理网络段
int Vlanif 254
ip add 10.1.254.7 24
#开启dhcp
dhcp select interface
dhcp server option 43 sub-option 2 ip-address 10.1.7.10 10.1.8.10
q

#业务网络段地址池
ip pool user
network 10.1.10.0 mask 24
gateway-list 10.1.10.254
q
int vlan10
dhcp select global
q

interface G0/0/10
port link-type access
port default vlan 7

interface G0/0/11
port link-type access
port default vlan 127

ospf 1 
area 1
network 10.1.0.0 0.0.255.255
quit
silent-interface Vlanif7
silent-interface Vlanif10
silent-interface Vlanif20
quit

int Vlanif 78
#优化网络类型
ospf network-type p2p
#优化网络接口，加快收敛
int Vlanif 127
ospf network-type p2p

```

## LSW2

```BASH
int Vlanif 8
ip add 10.1.8.8 24

int Vlanif 78
ip add 10.1.78.8 24

int Vlanif 138
ip add 10.1.138.8 24
q

interface G0/0/10
port link-type access
port default vlan 8

interface G0/0/11
port link-type access
port default vlan 138
q

ospf 1 
area 1
network 10.1.0.0 0.0.255.255
quit
silent-interface Vlanif8
silent-interface Vlanif10
silent-interface Vlanif20
quit

int Vlanif 78
#优化网络类型
ospf network-type p2p
#优化网络接口，加快收敛
int Vlanif 138
ospf network-type p2p
```

## LSW3

```BASH
interface G0/0/1
port link-type trunk
port trunk pvid vlan 254
port trunk allow-pass vlan 10 254

interface G0/0/10
port link-type access
port default vlan 20
q
```

## AC1

```bash
sys
sysname AC1

vlan 254

int vlan1
ip add 10.1.7.10 24

ip route-static 0.0.0.0 0 10.1.7.7

capwap source interface VLAN1

wlan
regulatory-domain-profile name Jack20
country-code CN 
quit

#在 WAC1 上创建 AP 组，并绑定域管理模板
ap auth-mode mac-auth
ap-group name Jack20
regulatory-domain-profile Jack20
----------------
y
quit

ap-mac 00e0-fcea-7350
ap-name ap1
ap-group Jack20
----------------
y

配置总部 AP 业务参数。
#在 WAC1 上创建 Jack20-Lab 安全模板
security-profile name Jack20-Lab
security wpa-wpa2 psk pass-phrase Jack20-Lab aes
quit

#在 WAC1 上创建 Jack20-Lab 的 SSID 模板。
ssid-profile name Jack20-Lab
ssid Jack20-Lab
quit

#创建AP配置模板
ap-system-profile name AP_PRO
#指定主AC
primary-access ip-address 10.1.7.10
#指定备份AC
backup-access ip-address 10.1.8.10
q
q

#双机热备
hsb-service 0
service-ip-port local-ip 10.1.7.10 peer-ip 10.1.8.10 local-data-port 10240 peer-data-port 10240

wlan
创建 VAP 模板，Jack20-Lab
#在 WAC1 上创建 Jack20-Lab 的 VAP 模板。
vap-profile name Jack20-Lab
forward-mode direct-forward 
service-vlan vlan-id 10
security-profile Jack20-Lab
ssid-profile Jack20-Lab
quit

#将 VAP 模板应用到 AP 组下。
在 WAC1 上应用 Jack20-Lab 和 Jack20-Interview 的 VAP 模板。
ap-group name Jack20
vap-profile Jack20-Lab wlan 1 radio all 
ap-system-profile AP_PRO
y
quit

#使能双链路同步
ac protect enable
y
```

## AC2

```bash
sys
sysname AC2

vlan 254

int vlan1
ip add 10.1.8.10 24

ip route-static 0.0.0.0 0 10.1.8.8

capwap source interface VLAN1

wlan
regulatory-domain-profile name Jack20
country-code CN 
quit

#在 WAC1 上创建 AP 组，并绑定域管理模板
ap auth-mode mac-auth
ap-group name Jack20
regulatory-domain-profile Jack20
----------------
y
quit

ap-mac 00e0-fcea-7350
ap-name ap1
ap-group Jack20
y

配置总部 AP 业务参数。
#在 WAC1 上创建 Jack20-Lab 安全模板
security-profile name Jack20-Lab
security wpa-wpa2 psk pass-phrase Jack20-Lab aes
quit

#在 WAC1 上创建 Jack20-Lab 的 SSID 模板。
ssid-profile name Jack20-Lab
ssid Jack20-Lab
quit

#创建AP配置模板
ap-system-profile name AP_PRO
#指定主AC
primary-access ip-address 10.1.7.10
#指定备份AC
backup-access ip-address 10.1.8.10
q

#双机热备
hsb-service 0
service-ip-port local-ip 10.1.8.10 peer-ip 10.1.7.10 local-data-port 10240 peer-data-port 10240
q

wlan
创建 VAP 模板，Jack20-Lab
#在 WAC1 上创建 Jack20-Lab 的 VAP 模板。
vap-profile name Jack20-Lab
forward-mode direct-forward 
service-vlan vlan-id 10
security-profile Jack20-Lab
ssid-profile Jack20-Lab
quit

#将 VAP 模板应用到 AP 组下。
在 WAC1 上应用 Jack20-Lab 和 Jack20-Interview 的 VAP 模板。
ap-group name Jack20
vap-profile Jack20-Lab wlan 1 radio all 
ap-system-profile AP_PRO
y
quit
q

#使能双链路同步
ac protect enable
y
```

查看结果

dis ospf brief

dis hsb-service 0

dis ip int brief

AC1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225144448706.png" alt="image-20211225144448706" style="zoom:80%;" />

AC2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211225144711585.png" alt="image-20211225144711585" style="zoom:80%;" />





8.2 FW-1,FW-2部署双机热备负载分担模式
    G1/0/0位于untrust区域
    G1/0/1位于trust区域
    G1/0/2位于dmz区域

若检测上行或下接口故障，自动切换角色
对于内网访问外网不做限制，外部访问内网放行必要流量

## CE1

```BASH
sys
sysname CE1

interface loopback0
ip address 10.1.1.1 32
quit

interface GigabitEthernet 0/0/0
ip address 10.1.121.1 24
ospf network-type p2p

interface GigabitEthernet 0/0/2
ip address 10.1.12.1 24
ospf network-type p2p

interface e 1/0/0
ip address 10.1.13.1 24
quit
```

## CE2

```BASH
sys
sysname CE2

interface loopback0
ip address 10.1.2.2 32
quit

interface GigabitEthernet 0/0/0
ip address 10.1.132.2 24
ospf network-type p2p
interface GigabitEthernet 0/0/1
ip address 100.1.23.2 24
interface GigabitEthernet 0/0/2
ip address 10.1.12.2 24
ospf network-type p2p

interface e 1/0/0
ip address 10.1.24.2 24
interface e 1/0/1
ip address 10.100.1.28 24
quit
```

dis ip int b

admin

Admin@123 -> 1q2w#E$R

## FW1

```BASH
sys
sysname FW1
#进入控制台调整超时时间为永不超时
user-interface console 0
idle-timeout 0 0
q

firewall zone untrust
add interface g1/0/0
firewall zone trust
add interface g1/0/1
firewall zone dmz
add interface g1/0/2
q

security-policy
rule name LOCAL_TO_ANY
source-zone local
action permit
q

interface GigabitEthernet 1/0/0
ip address 10.1.121.12 24
interface GigabitEthernet 1/0/1
ip address 10.1.127.12 24
interface GigabitEthernet 1/0/2
ip address 10.1.0.12 24
quit

#开启hrp负载分担指定接口和对端地址
hrp interface g1/0/2 remote 10.1.0.13
#开启同步配置
hrp auto-sync config
#使能开启
hrp enable

#端口加入链路组使得两边数据转发同断同起
interface GigabitEthernet 1/0/0
link-group 1
interface GigabitEthernet 1/0/1
link-group 1
q
```

## FW2

```BASH
sys
sysname FW2
#进入控制台调整超时时间为永不超时
user-interface console 0
idle-timeout 0 0
q

firewall zone untrust
add interface g1/0/0
firewall zone trust
add interface g1/0/1
firewall zone dmz
add interface g1/0/2
q

interface GigabitEthernet 1/0/0
ip address 10.1.132.13 24
interface GigabitEthernet 1/0/1
ip address 10.1.138.13 24
interface GigabitEthernet 1/0/2
ip address 10.1.0.13 24
quit

interface e 1/0/0
ip address 10.1.24.2 24
interface e 1/0/1
ip address 10.100.1.28 24
quit


hrp interface g1/0/2 remote 10.1.0.12
hrp auto-sync config
hrp enable

interface GigabitEthernet 1/0/0
link-group 1
interface GigabitEthernet 1/0/1
link-group 1
q
```

结果查看

dis hrp state

dis hrp state verbose

FW1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226121333562.png" alt="image-20211226121333562" style="zoom:80%;" />

负载分担开启且自动同步配置、自动同步会话均开启

FW2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226120813602.png" alt="image-20211226120813602" style="zoom:80%;" />

数据转发同断同起测试

CE1中模拟链路G0/0/0故障

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226151215448.png" alt="image-20211226151215448" style="zoom:80%;" />

就会防火墙两边链路一起终端切换备用防火墙工作

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226151147295.png" alt="image-20211226151147295" style="zoom:80%;" />



2.1 AS65000内部OSPF区域如图所示
     CE1,CE2的Loopback0属于区域0，
     FW1,FW2连接交换机处加入区域1
     FW1,FW2连接CE加入区域0
     FW1,FW2互联接口不加入OSPF进程

2.3.区域0使用MD5认证，CE1,CE2,FW1使用区域方式实现
    FW2采用接口方式实现

2.4.为防止区域0分裂，在FW-1,FW-2之间启用vlink作为备份



重启ospf    reset ospf pro

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226201040416.png" alt="image-20211226201040416" style="zoom:80%;" />

### CE1

```bash
ospf 1 
area 0
network 10.1.0.0 0.0.255.255
authentication-mode md5 1 plain Jack20
quit
silent-interface e1/0/0
quit
```

### CE2

```bash
ospf 1 
area 0
network 10.1.0.0 0.0.255.255
authentication-mode md5 1 plain Jack20
quit
silent-interface e1/0/0
quit
```

### FW1

```BASH
ospf 1 router-id 10.1.12.12
area 1
#实现vlink备份（因FW2采用接口认证，故需添加解除认证，以解决vlink启动问题）
vlink-peer 10.1.13.13 authentication-null
area 0
#添加MD5认证
authentication-mode md5 1 plain Jack20
quit

interface GigabitEthernet 1/0/1
ospf enable 1 area 1
#优化网络接口，加快收敛
ospf network-type p2p
interface GigabitEthernet 1/0/0
ospf enablen 1 area 0
ospf network-type p2p
q


```

### FW2

```BASH
ospf 1 router-id 10.1.13.13
area 1
vlink-peer 10.1.12.12
area 0
quit

interface GigabitEthernet 1/0/1
ospf enable 1 area 1
ospf network-type p2p
interface GigabitEthernet 1/0/0
ospf enable 1 area 0
ospf network-type p2p
#接口添加MD5认证
ospf authentication-mode md5 1 plain Jack20
q
```

dis ospf peer brief

dis ospf brief

dis ospf vlink



FW1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226202027523.png" alt="image-20211226202027523" style="zoom: 80%;" />

FW2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226194500889.png" alt="image-20211226194500889" style="zoom:80%;" />

CE1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226195622285.png" alt="image-20211226195622285" style="zoom:80%;" />

CE2

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226200708630.png" alt="image-20211226200708630" style="zoom:80%;" />



  SW1,SW2分别启用BFD检测CE1,CE2的Loopback0
  若BFD检测失败，自动切换主备角色

### LSW1

```bash
bfd
q
bfd TEST_R1 bind peer-ip 10.1.1.1 source-ip 10.1.127.7 auto
#设置发送与接收间隔500ms默认1000
min-tx-interval 500
#设置检测倍数默认3
detect-multiplier 4
commit
q
#关联至VRRP检测到失效后自动下调优先级5
int vlan 10
vrrp vrid 1 track bfd-session session-name TEST_R1 reduced 5

```

### CE1

```bash
bfd
q
bfd TEST_S1 bind peer-ip 10.1.127.7 source-ip 10.1.1.1 auto
#设置发送与接收间隔500ms默认1000
min-tx-interval 500
#设置检测倍数默认3
detect-multiplier 4
commit
q

```



### LSW2

```bash
bfd
q
bfd TEST_CE2 bind peer-ip 10.1.2.2 source-ip 10.1.138.8 auto
min-tx-interval 500
detect-multiplier 4
commit
q
int vlan 20
vrrp vrid 2 track bfd-session session-name TEST_CE2 reduced 5
```

### CE2

```bash
bfd
q
bfd TEST_S2 bind peer-ip 10.1.138.8 source-ip 10.1.2.2 auto
min-tx-interval 500
detect-multiplier 4
commit
q
```

### FW1

```bash
security-policy
rule name IN_TO_OUT
source-zone trust
destination-zone untrust
action permit

rule name OUT_TO_IN
source-zone untrust
destination-zone trust
service protocol udp destination-port 3784
action permit
q
```

dis bfd session all

dis vrrp 1

dis firewall session table

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226205505202.png" alt="image-20211226205505202" style="zoom:80%;" />

FW1

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211226205607056.png" alt="image-20211226205607056" style="zoom:80%;" />



2.10 .CE2配置策略路由实现10.1.10.X访问公网时，
      X为奇数使用XR8作为下一跳
      X为偶数使用YR3作为下一跳

7.2 CE2添加公网地址池：
    100.1.23.11-100.1.23.20 为ISP1(AS200)分配
    100.1.28.11-100.1.28.20 为ISP2(AS100)分配
    用于地址转换

### CE2

```bash
acl 2001
rule permit source 10.1.10.1 0.0.0.254
acl 2002
rule permit source 10.1.10.0 0.0.0.254
q
#定义两个分类
traffic classifier EVEN_CAMP
if-match acl 2001
traffic classifier ODD_CAMP
if-match acl 2002
q
#定义两个行为
traffic behavior EVEN_CAMP
redirect ip-nexthop 100.1.28.8
statistic enable
traffic behavior ODD_CAMP
redirect ip-nexthop 100.1.23.3
statistic enable
q
traffic policy PBR
classifier EVEN_CAMP behavior EVEN_CAMP 
classifier ODD_CAMP behavior ODD_CAMP
q

int g0/0/2
traffic-policy PBR inbound

#配置NAT
acl 2000
rule permit source 10.1.10.0 0.0.0.255
q 

#创建NAT地址池
nat address-group 1 100.1.28.11 100.1.28.20
nat address-group 2 100.1.23.11 100.1.23.20
#使能地址池
int e1/0/1	
nat outbound 2000 address-group 1
int g0/0/1
nat outbound 2000 address-group 2
q
```

dis traffic policy statistics interface g0/0/2 inbound verbose rule-base



# 外网部分

IP编址

2.2.XR5,XR7互联接口启用IP-Trunk1，IP地址如图所示

## XR3

```BASH
sys
sysname XR3
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.3.3 32
quit

interface GigabitEthernet 0/0/0
ip address 155.1.35.3 24

interface GigabitEthernet 0/0/2
ip address 155.1.34.3 24

interface e 0/0/1
ip address 155.1.3.3 24
quit
```

## XR4

```BASH
sys
sysname XR4
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.4.4 32

interface GigabitEthernet 0/0/0
ip address 155.1.46.4 24

interface GigabitEthernet 0/0/2
ip address 155.1.34.4 24

interface e 0/0/0
ip address 155.1.24.4 24
quit
```

## XR5

```BASH
sys
sysname XR5
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.5.5 32

interface GigabitEthernet 0/0/0
ip address 155.1.35.5 24

interface GigabitEthernet 0/0/2
ip address 155.1.56.5 24
q

#XR5,XR7互联接口启用IP-Trunk1
interface S0/0/0
link-protocol hdlc
y
interface S0/0/1
link-protocol hdlc
y

int Ip-Trunk 1
trunkport s0/0/0
trunkport s0/0/1
ip add 155.1.57.5 24
q
```

## XR6

```BASH
sys
sysname XR6
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.6.6 32

interface GigabitEthernet 0/0/0
ip address 155.1.46.6 24

interface GigabitEthernet 0/0/1
ip address 155.1.68.6 24

interface GigabitEthernet 0/0/2
ip address 155.1.56.6 24
q
```

## XR7

```BASH
sys
sysname XR7
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.7.7 32

interface GigabitEthernet 0/0/0
ip address 155.1.78.7 24

interface e 0/0/1
ip address 100.1.57.7 24
q

#XR5,XR7互联接口启用IP-Trunk1
interface S0/0/0
link-protocol hdlc
y
interface S0/0/1
link-protocol hdlc
y

int Ip-Trunk 1
trunkport s0/0/0
trunkport s0/0/1
ip add 155.1.57.5 24
q
```

## XR8

```BASH
sys
sysname XR8
user-interface console 0
idle-timeout 0 0
q

interface loopback0
ip address 150.1.8.8 32

interface GigabitEthernet 0/0/0
ip address 155.1.78.8 24

interface GigabitEthernet 0/0/1
ip address 155.1.68.8 24

interface e 0/0/0
ip address 100.1.58.8 24

interface e 0/0/1
ip address 100.1.28.8 24
q
```

display interface Ip-Trunk

<img src="C:\Users\Jack20\AppData\Roaming\Typora\typora-user-images\image-20211227115717450.png" alt="image-20211227115717450" style="zoom:80%;" />



2.5.XR5,XR6,XR7,XR8互联接口加入OSPF区域0
   XR7-lo0加入OSPF区域0，XR8-lo0精确引入到OSPF,使用外部类型1
   XR5-lo0，XR6-lo0加入ISIS进程
   调整XR5-G0/0/0接口开销为35
   XR3,XR4,XR5,XR6互联与loopback0加入骨干区域49.0000

2.6 XR5,XR6双向引入，并且消除AS100内的次优路径，采用扩展方式实现

2.7 修改XR5与XR6的ISIS网络类型为P2P
    修改XR8与XR7的OSPF网络类型为P2P

## XR3

```BASH
#配置isis
isis
network-entity 49.0000.0000.0000.0003.00
is-level level-2

interface loopback0
isis en
interface GigabitEthernet 0/0/0
isis en
interface GigabitEthernet 0/0/2
isis en
q
```

## XR4

```BASH
isis
network-entity 49.0000.0000.0000.0004.00
is-level level-2

interface loopback0
isis en
interface GigabitEthernet 0/0/0
isis en
interface GigabitEthernet 0/0/2
isis en
q
```

## XR5

```BASH
isis
network-entity 49.0000.0000.0000.0005.00
is-level level-2

interface loopback0
isis en
interface GigabitEthernet 0/0/0
isis en
isis cost 35
interface GigabitEthernet 0/0/2
isis en
q

#配置ospf
ospf 1 
area 0

interface GigabitEthernet 0/0/2
ospf enable 1 area 0

int Ip-Trunk 1
ospf enable 1 area 0
q

#isis和ospf双向引入并继承开销
isis
import-route ospf 1 inherit-cost
ospf 1 
default cost inherit-metric
import-route isis 1
q

```

## XR6

```BASH
isis
network-entity 49.0000.0000.0000.0006.00
is-level level-2

interface loopback0
isis en
interface GigabitEthernet 0/0/0
isis en
interface GigabitEthernet 0/0/2
isis en
q

#配置ospf
ospf 1 
area 0
interface GigabitEthernet 0/0/1
ospf enable 1 area 0
interface GigabitEthernet 0/0/2
ospf enable 1 area 0
q

#isis和ospf双向引入并继承开销
isis
import-route ospf 1 inherit-cost
ospf 1 
default cost inherit-metric
import-route isis 1
q
```

## XR7

```BASH
#配置ospf
ospf 1 
area 0

interface GigabitEthernet 0/0/0
ospf enable 1 area 0
ospf network-type p2p

int Ip-Trunk 1
ospf enable 1 area 0
ospf network-type p2p

interface loopback0
ospf enable 1 area 0
ospf network-type p2p
q
```

## XR8

```BASH
#配置ospf
ospf 1 
area 0

interface GigabitEthernet 0/0/0
ospf enable 1 area 0
ospf network-type p2p

interface GigabitEthernet 0/0/1
ospf enable 1 area 0
ospf network-type p2p
q

#环回口精确引入ospf
#添加前缀列表
ip ip-prefix NET8 permit 150.1.8.8 32
#路由策略 直连到ospf
route-policy DIR->OSPF permit node 10
#将路由策略匹配前缀列表
if-match ip-prefix NET8
q
#ospf引入直连
ospf 1 
import-route direct route-policy DIR->OSPF type 1
q
```

在XR6中tracert -q 1 -a 150.1.6.6 150.1.8.8
